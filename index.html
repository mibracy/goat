<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>üêê</title>
        <style>
            body {
                background-color: #000;
                color: #0f0;
                font-family: "Courier New", Courier, monospace;
                margin: 20px;
            }
            @keyframes pulse {
                0% {
                    text-shadow:
                        0 0 5px #0f0,
                        0 0 10px #0f0,
                        0 0 15px #0f0,
                        0 0 20px #0f0;
                }
                50% {
                    text-shadow:
                        0 0 10px #0f0,
                        0 0 20px #0f0,
                        0 0 30px #0f0,
                        0 0 40px #0f0;
                }
                100% {
                    text-shadow:
                        0 0 5px #0f0,
                        0 0 10px #0f0,
                        0 0 15px #0f0,
                        0 0 20px #0f0;
                }
            }

            h1 {
                text-align: center;
                text-transform: uppercase;
                letter-spacing: 5px;
                animation: pulse 4.2s infinite alternate; /* Apply the pulse animation */
            }
            h1:hover,
            h2:hover {
                text-shadow:
                    0 0 5px #0f0,
                    0 0 10px #0f0,
                    0 0 15px #0f0,
                    0 0 20px #0f0;
            }
            .menu {
                text-align: center;
            }
            .menu button {
                background-color: #222;
                color: #0f0;
                border: 1px solid #0f0;
                padding: 10px 15px;
                cursor: pointer;
                text-transform: uppercase;
            }
            .menu button.active {
                background-color: #0f0;
                color: #000;
            }
            .model-section {
                display: none;
            }
            .model-section.active {
                display: block;
            }
            .admin-sub-section {
                display: none;
            }
            .admin-sub-section.active {
                display: block;
            }
            div {
                border: 1px solid #0f0;
                border-radius: 0;
                margin-bottom: 20px;
                padding: 15px;
            }
            h2,
            h3 {
                color: #0f0;
                text-transform: uppercase;
                transition: text-shadow 0.3s ease-in-out;
            }
            label {
                display: block;
                margin-bottom: 5px;
            }
            input[type="text"],
            input[type="number"],
            input[type="password"],
            select,
            textarea {
                background-color: #222;
                color: #0f0;
                border: 1px solid #0f0;
                padding: 8px;
                width: 200px; /* Default width, overridden by grid */
                margin-bottom: 0; /* Removed margin-bottom, using grid gap */
                -webkit-appearance: none; /* Remove default dropdown arrow for better styling */
                -moz-appearance: none;
                appearance: none;
                background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%204%205%22%3E%3Cpath%20fill%3D%22%230F0%22%20d%3D%22M2%200L0%202h4zm0%205L0%203h4z%22%2F%3E%3C%2Fsvg%3E"); /* Custom arrow */
                background-repeat: no-repeat;
                background-position: right 0.7em top 50%;
                background-size: 0.65em auto;
            }

            input[type="checkbox"] {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                display: inline-block;
                width: 16px;
                height: 16px;
                border: 1px solid #0f0;
                background-color: #222;
                vertical-align: middle;
                position: relative;
                cursor: pointer;
            }

            input[type="checkbox"]:checked {
                background-color: #0f0;
            }

            input[type="checkbox"]:checked::after {
                content: "\2713"; /* Checkmark character */
                color: #000;
                font-size: 12px;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

            textarea {
                resize: vertical; /* Allow vertical resizing */
                min-height: 80px; /* Minimum height for multiline */
            }

            /* Style for the form layout */
            .form-group-item {
                display: grid;
                grid-template-columns: 150px 1fr; /* Label fixed, input fluid */
                gap: 10px;
                margin-bottom: 10px; /* Gap between form items */
                align-items: center;
            }

            .form-group-item label {
                text-align: right;
                padding-right: 10px;
            }

            .form-group-item input,
            .form-group-item select,
            .form-group-item textarea {
                width: 100%;
                box-sizing: border-box;
            }

            /* Specific width for title input */
            #createTicketForm .form-group-item:nth-child(1) {
                /* Targeting the title form-group-item */
                grid-template-columns: 150px 40%; /* Label 150px, input 40% of the row */
            }

            /* Full width for description */
            #createTicketForm .form-group-item.full-width-item {
                grid-template-columns: 150px 1fr; /* Label 150px, input takes rest */
            }

            #createTicketForm .form-group-item.full-width-item label {
                text-align: left; /* Align label to left for full-width items */
                padding-right: 0;
            }

            .form-group-grid {
                display: grid;
                grid-template-columns: repeat(
                    2,
                    1fr
                ); /* Two columns for status/priority and requester/assignee */
                gap: 10px;
            }

            .form-group-grid .form-group-item {
                margin-bottom: 0; /* Remove margin as gap handles it */
            }
            button {
                background-color: #0f0;
                color: #000;
                border: none;
                padding: 10px 15px;
                cursor: pointer;
                text-transform: uppercase;
                transition: text-shadow 0.3s ease-in-out;
            }
            button:hover {
                background-color: #0a0;
                text-shadow:
                    0 0 5px #0f0,
                    0 0 10px #0f0,
                    0 0 15px #0f0,
                    0 0 20px #0f0;
            }
            .button-group {
                display: flex;
                flex-wrap: wrap;
                gap: 10px; /* Spacing between buttons */
                justify-content: center; /* Center buttons */
                margin-bottom: 10px;
            }
            .button-group form {
                margin: 0; /* Remove default form margin */
            }
            .button-group button {
                width: auto; /* Adjust button width */
                flex-grow: 1; /* Allow buttons to grow and fill space */
                min-width: 120px; /* Minimum width for mobile */
            }
            pre {
                background-color: #111;
                border: 1px dashed #0f0;
                padding: 10px;
                overflow-x: auto;
                white-space: pre-wrap;
                word-wrap: break-word;
            }

            #response-container {
                max-height: 50vh;
                overflow-y: auto;
                border: 1px solid #0f0;
                padding: 10px;
                margin-top: 20px;
            }

            /* Mobile responsiveness */
            @media (max-width: 768px) {
                .form-group-item {
                    grid-template-columns: 1fr; /* Stack labels and inputs vertically */
                }

                .form-group-item label {
                    text-align: left; /* Align labels to the left on mobile */
                    padding-right: 0;
                }

                .form-group-grid {
                    grid-template-columns: 1fr; /* Stack grid items vertically */
                }

                .button-group button {
                    flex-grow: unset; /* Remove flex-grow for better stacking */
                    width: 100%; /* Full width buttons */
                }
            }
        </style>
    </head>
    <body>
        <h1>GOAT API Viewer</h1>

        <div class="menu">
            <button onclick="showModel('login')" class="active">Login</button>
            <button onclick="showModel('admin')">Admin</button>
            <button onclick="showModel('agent')">Agent</button>
            <button onclick="showModel('customer')">Customer</button>
        </div>

        <div id="login" class="model-section active">
            <h2>Login / Register</h2>

            <div class="menu">
                <button onclick="showLoginSection('register-customer')">
                    Register
                </button>
                <button
                    onclick="showLoginSection('authenticate')"
                    class="active"
                >
                    Login
                </button>
                <button onclick="showLoginSection('clear-jwt')">Logout</button>
                <button onclick="showLoginSection('forgot-password')">
                    Forgot Password
                </button>
            </div>

            <div id="login-authenticate" class="login-sub-section active">
                <h3>Authenticate (POST /login)</h3>
                <form id="loginForm">
                    <div class="form-group-item">
                        <label for="loginEmail">Email:</label>
                        <input
                            type="text"
                            id="loginEmail"
                            name="email"
                            required
                        />
                    </div>
                    <div class="form-group-item">
                        <label for="loginPassword">Password:</label>
                        <input
                            type="password"
                            id="loginPassword"
                            name="password"
                            required
                        />
                    </div>
                    <button type="submit">Login</button>
                </form>
            </div>

            <div id="login-register-customer" class="login-sub-section">
                <h3>Register New Customer (POST /register)</h3>
                <form id="registerCustomerForm">
                    <div class="form-group-item">
                        <label for="registerCustomerName">Name:</label>
                        <input
                            type="text"
                            id="registerCustomerName"
                            name="name"
                            required
                        />
                    </div>
                    <div class="form-group-item">
                        <label for="registerCustomerEmail">Email:</label>
                        <input
                            type="text"
                            id="registerCustomerEmail"
                            name="email"
                            required
                        />
                    </div>
                    <div class="form-group-item">
                        <label for="registerCustomerPassword">Password:</label>
                        <input
                            type="password"
                            id="registerCustomerPassword"
                            name="password"
                            required
                        />
                    </div>
                    <button type="submit">Register Customer</button>
                </form>
            </div>

            <div id="login-clear-jwt" class="login-sub-section">
                <h3>Current JWT:</h3>
                <pre id="currentJwt"></pre>
                <button onclick="clearJwt()">Clear JWT</button>
            </div>

            <div id="login-forgot-password" class="login-sub-section">
                <h3>Forgot Password (POST /forgot-password)</h3>
                <form id="forgotPasswordForm">
                    <div class="form-group-item">
                        <label for="forgotPasswordEmail">Email:</label>
                        <input
                            type="text"
                            id="forgotPasswordEmail"
                            name="email"
                            required
                        />
                    </div>
                    <button type="submit">Request Reset</button>
                </form>

                <h3>Reset Password (POST /reset-password)</h3>
                <form id="resetPasswordForm">
                    <div class="form-group-item">
                        <label for="resetToken">Token:</label>
                        <input
                            type="text"
                            id="resetToken"
                            name="token"
                            required
                        />
                    </div>
                    <div class="form-group-item">
                        <label for="newPassword">New Password:</label>
                        <input
                            type="password"
                            id="newPassword"
                            name="new_password"
                            required
                        />
                    </div>
                    <button type="submit">Reset Password</button>
                </form>
            </div>
        </div>

        <div id="admin" class="model-section">
            <h2>Admin</h2>
            <div class="menu">
                <button onclick="showAdminSection('users')" class="active">
                    Users
                </button>
                <button onclick="showAdminSection('tickets')">Tickets</button>
                <button onclick="showAdminSection('comments')">Comments</button>
            </div>

            <div id="admin-users" class="admin-sub-section active">
                <h3>List Users (GET /admin/) (GET /admin/role/{role})</h3>
                <div class="button-group">
                    <form id="listUsersForm">
                        <button type="submit">All</button>
                    </form>
                    <form id="listAdminsForm">
                        <button type="submit">Admins</button>
                    </form>
                    <form id="listAgentsForm">
                        <button type="submit">Agents</button>
                    </form>
                    <form id="listCustomersForm">
                        <button type="submit">Customers</button>
                    </form>
                </div>

                <div id="admin-create-user" class="disabled-admin-sub-section">
                    <h3>Create User (POST /admin/)</h3>
                    <form id="createUserForm">
                        <div class="form-group-item">
                            <label for="createName">Name:</label>
                            <input
                                type="text"
                                id="createName"
                                name="name"
                                required
                            />
                        </div>
                        <div class="form-group-item">
                            <label for="createEmail">Email:</label>
                            <input
                                type="text"
                                id="createEmail"
                                name="email"
                                required
                            />
                        </div>
                        <div class="form-group-item">
                            <label for="createRole">Role:</label>
                            <select id="createRole" name="role">
                                <option value="Customer">Customer</option>
                                <option value="Agent">Agent</option>
                                <option value="Admin">Admin</option>
                            </select>
                        </div>
                        <button type="submit">Create User</button>
                    </form>
                </div>

                <div id="admin-get-user" class="disabled-admin-sub-section">
                    <h3>Get User by ID (GET /admin/{id})</h3>
                    <form id="getUserForm">
                        <label for="getUserId">User ID:</label>
                        <input
                            type="text"
                            id="getUserId"
                            name="id"
                            required
                            class="js-number-input"
                        />
                        <button type="submit">Get User</button>
                    </form>
                </div>

                <div id="admin-update-user" class="disabled-admin-sub-section">
                    <h3>Update User (PUT /admin/update/{id})</h3>
                    <form id="updateUserForm">
                        <div class="form-group-item">
                            <label for="updateUserId">User ID:</label>
                            <input
                                type="text"
                                id="updateUserId"
                                name="id"
                                required
                                class="js-number-input"
                            />
                        </div>
                        <div class="form-group-item">
                            <label for="updateName">New Name:</label>
                            <input
                                type="text"
                                id="updateName"
                                name="name"
                                required
                            />
                        </div>
                        <div class="form-group-item">
                            <label for="updateEmail">New Email:</label>
                            <input
                                type="text"
                                id="updateEmail"
                                name="email"
                                required
                            />
                        </div>
                        <div class="form-group-item">
                            <label for="updateRole">New Role:</label>
                            <select id="updateRole" name="role">
                                <option value="Customer">Customer</option>
                                <option value="Agent">Agent</option>
                                <option value="Admin">Admin</option>
                            </select>
                        </div>
                        <button type="submit">Update User</button>
                    </form>
                </div>

                <div id="admin-delete-user" class="disabled-admin-sub-section">
                    <h3>Delete User (DELETE /admin/delete/{id})</h3>
                    <form id="deleteUserForm">
                        <label for="deleteUserId">User ID:</label>
                        <input
                            type="text"
                            id="deleteUserId"
                            name="id"
                            required
                            class="js-number-input"
                        />
                        <button type="submit">Delete User</button>
                    </form>
                </div>
            </div>

            <div id="admin-tickets" class="admin-sub-section">
                <h2>Tickets</h2>
                <div>
                    <h3>List Tickets (GET /admin/tickets)</h3>
                    <form id="listTicketsForm">
                        <button type="submit">List All Tickets</button>
                    </form>
                </div>

                <div>
                    <h3>Create/Update Ticket</h3>
                    <div class="button-group">
                        <button
                            onclick="showTicketForm('create')"
                            class="active"
                        >
                            Create Ticket
                        </button>
                        <button onclick="showTicketForm('update')">
                            Update Ticket
                        </button>
                    </div>

                    <div id="createTicketSection">
                        <form id="createTicketForm">
                            <div class="form-group-item">
                                <label for="createTicketTitle">Title:</label>
                                <input
                                    type="text"
                                    id="createTicketTitle"
                                    name="title"
                                    required
                                />
                            </div>

                            <div class="form-group-item full-width-item">
                                <label for="createTicketDescription"
                                    >Description:</label
                                >
                                <textarea
                                    id="createTicketDescription"
                                    name="description"
                                ></textarea>
                            </div>

                            <div class="form-group-grid">
                                <div class="form-group-item">
                                    <label for="createTicketStatus"
                                        >Status:</label
                                    >
                                    <select
                                        id="createTicketStatus"
                                        name="status"
                                    >
                                        <option value="Open">Open</option>
                                    </select>
                                </div>
                                <div class="form-group-item">
                                    <label for="createTicketPriority"
                                        >Priority:</label
                                    >
                                    <select
                                        id="createTicketPriority"
                                        name="priority"
                                    >
                                        <option value="Low">Low</option>
                                        <option value="Medium">Medium</option>
                                        <option value="High">High</option>
                                        <option value="Urgent">Urgent</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group-grid">
                                <div class="form-group-item">
                                    <label for="createTicketRequesterId"
                                        >Requester ID:</label
                                    >
                                    <input
                                        type="text"
                                        id="createTicketRequesterId"
                                        name="requester_id"
                                        required
                                        class="js-number-input"
                                    />
                                </div>
                                <div class="form-group-item">
                                    <label for="createTicketAssigneeId"
                                        >Assignee ID (Optional):</label
                                    >
                                    <input
                                        type="text"
                                        id="createTicketAssigneeId"
                                        name="assignee_id"
                                        class="js-number-input"
                                    />
                                </div>
                            </div>

                            <button type="submit">Create Ticket</button>
                        </form>
                    </div>

                    <div id="updateTicketSection" style="display: none">
                        <form id="loadTicketForm">
                            <label for="updateTicketId">Ticket ID:</label>
                            <input
                                type="text"
                                id="updateTicketId"
                                name="id"
                                required
                                class="js-number-input"
                            />
                            <button type="submit">Load Ticket</button>
                        </form>
                        <form
                            id="updateTicketForm"
                            style="padding-top: 5px; display: none"
                        >
                            <input
                                type="hidden"
                                id="hiddenUpdateTicketId"
                                name="id"
                            />
                            <div class="form-group-item">
                                <label for="updateTicketTitle">Title:</label>
                                <input
                                    type="text"
                                    id="updateTicketTitle"
                                    name="title"
                                    required
                                />
                            </div>

                            <div class="form-group-item full-width-item">
                                <label for="updateTicketDescription"
                                    >Description:</label
                                >
                                <textarea
                                    id="updateTicketDescription"
                                    name="description"
                                ></textarea>
                            </div>

                            <div class="form-group-grid">
                                <div class="form-group-item">
                                    <label for="updateTicketStatus"
                                        >Status:</label
                                    >
                                    <select
                                        id="updateTicketStatus"
                                        name="status"
                                    >
                                        <option value="Open">Open</option>
                                        <option value="In Progress">
                                            In Progress
                                        </option>
                                        <option value="Resolved">
                                            Resolved
                                        </option>
                                        <option value="Closed">Closed</option>
                                    </select>
                                </div>
                                <div class="form-group-item">
                                    <label for="updateTicketPriority"
                                        >Priority:</label
                                    >
                                    <select
                                        id="updateTicketPriority"
                                        name="priority"
                                    >
                                        <option value="Low">Low</option>
                                        <option value="Medium">Medium</option>
                                        <option value="High">High</option>
                                        <option value="Urgent">Urgent</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group-grid">
                                <div class="form-group-item">
                                    <label for="updateTicketRequesterId"
                                        >Requester ID:</label
                                    >
                                    <input
                                        type="text"
                                        id="updateTicketRequesterId"
                                        name="requester_id"
                                        required
                                        class="js-number-input"
                                    />
                                </div>
                                <div class="form-group-item">
                                    <label for="updateTicketAssigneeId"
                                        >Assignee ID (Optional):</label
                                    >
                                    <input
                                        type="text"
                                        id="updateTicketAssigneeId"
                                        name="assignee_id"
                                        class="js-number-input"
                                    />
                                </div>
                            </div>

                            <button type="submit">Update Ticket</button>
                        </form>
                    </div>
                </div>
            </div>

            <div id="admin-comments" class="admin-sub-section">
                <h2>Comments</h2>
                <div class="button-group">
                    <button
                        onclick="callApi('GET', `${baseUrl}/admin/comments`)"
                        class="active"
                    >
                        List All Comments
                    </button>
                    <button onclick="showCommentSection('view_ticket')">
                        Lookup Ticket
                    </button>
                </div>

                <div id="viewTicketDetailsSection">
                    <h3>Ticket Details</h3>
                    <form id="loadTicketDetailsForm">
                        <label for="viewTicketId">Ticket ID:</label>
                        <input
                            type="text"
                            id="viewTicketId"
                            name="id"
                            required
                            class="js-number-input"
                        />
                        <button type="submit">Load Ticket Details</button>
                    </form>
                    <form
                        id="ticketDetailsForm"
                        style="padding-top: 5px; display: none"
                    >
                        <div class="form-group-item">
                            <label>ID:</label>
                            <input type="text" id="detailTicketId" readonly />
                        </div>
                        <div class="form-group-item">
                            <label>Title:</label>
                            <input
                                type="text"
                                id="detailTicketTitle"
                                readonly
                            />
                        </div>
                        <div class="form-group-item full-width-item">
                            <label>Description:</label>
                            <textarea
                                id="detailTicketDescription"
                                readonly
                            ></textarea>
                        </div>

                        <div class="form-group-grid">
                            <div class="form-group-item">
                                <label>Status:</label>
                                <input
                                    type="text"
                                    id="detailTicketStatus"
                                    readonly
                                />
                            </div>
                            <div class="form-group-item">
                                <label>Priority:</label>
                                <input
                                    type="text"
                                    id="detailTicketPriority"
                                    readonly
                                />
                            </div>
                        </div>

                        <div class="form-group-grid">
                            <div class="form-group-item">
                                <label>Requester ID:</label>
                                <input
                                    type="text"
                                    id="detailTicketRequesterId"
                                    readonly
                                />
                            </div>
                            <div class="form-group-item">
                                <label>Assignee ID:</label>
                                <input
                                    type="text"
                                    id="detailTicketAssigneeId"
                                    readonly
                                />
                            </div>
                        </div>

                        <div class="form-group-grid">
                            <div class="form-group-item">
                                <label>Created At:</label>
                                <input
                                    type="text"
                                    id="detailTicketCreatedAt"
                                    readonly
                                />
                            </div>
                            <div class="form-group-item">
                                <label>Updated At:</label>
                                <input
                                    type="text"
                                    id="detailTicketUpdatedAt"
                                    readonly
                                />
                            </div>
                            <div class="form-group-item">
                                <label>Closed At:</label>
                                <input
                                    type="text"
                                    id="detailTicketClosedAt"
                                    readonly
                                />
                            </div>
                        </div>
                    </form>

                    <div id="addCommentSection">
                        <h3>Add New Comment</h3>
                        <form id="addCommentForm">
                            <div class="form-group-item">
                                <label for="addCommentTicketId"
                                    >Ticket ID:</label
                                >
                                <input
                                    type="text"
                                    id="addCommentTicketId"
                                    name="ticket_id"
                                    required
                                    readonly
                                    class="js-number-input"
                                />
                            </div>
                            <div class="form-group-item">
                                <label for="addCommentAuthorId"
                                    >Author ID:</label
                                >
                                <input
                                    type="text"
                                    id="addCommentAuthorId"
                                    name="author_id"
                                    required
                                    class="js-number-input"
                                />
                            </div>
                            <div class="form-group-item full-width-item">
                                <label for="addCommentBody">Comment:</label>
                                <textarea
                                    id="addCommentBody"
                                    name="body"
                                    required
                                ></textarea>
                            </div>
                            <div class="form-group-item">
                                <label for="addCommentIsInternal"
                                    >Internal Only:</label
                                >
                                <input
                                    type="checkbox"
                                    id="addCommentIsInternal"
                                    name="is_internal"
                                    style="max-width: 25%; min-height: 42px"
                                />
                            </div>
                            <button type="submit">Add Comment</button>
                        </form>
                    </div>

                    <div id="ticketCommentsSection">
                        <h3>Comments for this Ticket</h3>
                        <input
                            type="text"
                            id="commentSearchInput"
                            placeholder="Search comments..."
                            style="
                                width: 90%;
                                margin-bottom: 10px;
                                margin-left: 3%;
                            "
                        />
                        <div
                            style="
                                max-height: 600px;
                                overflow-y: auto;
                                border: 1px solid #0f0;
                            "
                        >
                            <table
                                id="ticketCommentsTable"
                                style="width: 100%; margin-top: 10px"
                            >
                                <thead>
                                    <tr>
                                        <th
                                            style="
                                                border: 1px solid #0f0;
                                                padding: 8px;
                                                text-align: center;
                                                position: sticky;
                                                top: 0;
                                                background-color: #000;
                                                z-index: 1;
                                            "
                                        >
                                            ID
                                        </th>
                                        <th
                                            style="
                                                border: 1px solid #0f0;
                                                padding: 8px;
                                                text-align: center;
                                                position: sticky;
                                                top: 0;
                                                background-color: #000;
                                                z-index: 1;
                                            "
                                        >
                                            Author ID
                                        </th>
                                        <th
                                            style="
                                                border: 1px solid #0f0;
                                                padding: 8px;
                                                text-align: left;
                                                position: sticky;
                                                top: 0;
                                                background-color: #000;
                                                z-index: 1;
                                            "
                                        >
                                            Body
                                        </th>
                                        <th
                                            style="
                                                border: 1px solid #0f0;
                                                padding: 8px;
                                                text-align: center;
                                                position: sticky;
                                                top: 0;
                                                background-color: #000;
                                                z-index: 1;
                                            "
                                        >
                                            Internal
                                        </th>
                                        <th
                                            style="
                                                border: 1px solid #0f0;
                                                padding: 8px;
                                                text-align: left;
                                                position: sticky;
                                                top: 0;
                                                background-color: #000;
                                                z-index: 1;
                                            "
                                        >
                                            Created At
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Comments will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="agent" class="model-section">
            <h2>Agent Features</h2>
            <div>
                <h3>Agent Ticket Actions</h3>
                <div class="button-group">
                    <button onclick="callApi('GET', `${baseUrl}/agent/tickets`)">List My Tickets</button>
                    <button onclick="callApi('GET', `${baseUrl}/agent/tickets/open`)">List All Open Tickets</button>
                </div>
            </div>

            <div>
                <h3>
                    View/Update Assigned Ticket (GET/PUT /agent/tickets/{id})
                </h3>
                <form id="loadAgentTicketForm">
                    <label for="agentTicketId">Ticket ID:</label>
                    <input
                        type="text"
                        id="agentTicketId"
                        name="id"
                        required
                        class="js-number-input"
                    />
                    <button type="submit">Load Ticket</button>
                </form>
                <form
                    id="updateAgentTicketForm"
                    style="padding-top: 5px; display: none"
                >
                    <input type="hidden" id="hiddenAgentTicketId" name="id" />
                    <div class="form-group-item">
                        <label for="agentTicketTitle">Title:</label>
                        <input
                            type="text"
                            id="agentTicketTitle"
                            name="title"
                            readonly
                        />
                    </div>
                    <div class="form-group-item full-width-item">
                        <label for="agentTicketDescription">Description:</label>
                        <textarea
                            id="agentTicketDescription"
                            name="description"
                            readonly
                        ></textarea>
                    </div>
                    <div class="form-group-grid">
                        <div class="form-group-item">
                            <label for="agentTicketStatus">Status:</label>
                            <select id="agentTicketStatus" name="status">
                                <option value="Open">Open</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Resolved">Resolved</option>
                                <option value="Closed">Closed</option>
                            </select>
                        </div>
                        <div class="form-group-item">
                            <label for="agentTicketPriority">Priority:</label>
                            <select id="agentTicketPriority" name="priority">
                                <option value="Low">Low</option>
                                <option value="Medium">Medium</option>
                                <option value="High">High</option>
                                <option value="Urgent">Urgent</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit">Update Ticket</button>
                </form>
            </div>

            <div>
                <h3>
                    Add Comment to Ticket (POST /agent/tickets/{id}/comments)
                </h3>
                <form id="addAgentCommentForm">
                    <div class="form-group-item">
                        <label for="agentCommentTicketId">Ticket ID:</label>
                        <input
                            type="text"
                            id="agentCommentTicketId"
                            name="ticket_id"
                            required
                            class="js-number-input"
                        />
                    </div>
                    <div class="form-group-item full-width-item">
                        <label for="agentCommentBody">Comment:</label>
                        <textarea
                            id="agentCommentBody"
                            name="body"
                            required
                        ></textarea>
                    </div>
                    <div class="form-group-item">
                        <label for="agentCommentIsInternal"
                            >Internal Only:</label
                        >
                        <input
                            type="checkbox"
                            id="agentCommentIsInternal"
                            name="is_internal"
                            style="max-width: 25%; min-height: 42px"
                        />
                    </div>
                    <button type="submit">Add Comment</button>
                </form>
            </div>

            <div id="agentTicketCommentsSection" style="display: none">
                <h3>Comments for this Ticket</h3>
                <input
                    type="text"
                    id="agentCommentSearchInput"
                    placeholder="Search comments..."
                    style="
                        width: 90%;
                        margin-bottom: 10px;
                        margin-left: 3%;
                    "
                />
                <div
                    style="
                        max-height: 600px;
                        overflow-y: auto;
                        border: 1px solid #0f0;
                    "
                >
                    <table
                        id="agentTicketCommentsTable"
                        style="width: 100%; margin-top: 10px"
                    >
                        <thead>
                            <tr>
                                <th
                                    style="
                                        border: 1px solid #0f0;
                                        padding: 8px;
                                        text-align: center;
                                        position: sticky;
                                        top: 0;
                                        background-color: #000;
                                        z-index: 1;
                                    "
                                >
                                    ID
                                </th>
                                <th
                                    style="
                                        border: 1px solid #0f0;
                                        padding: 8px;
                                        text-align: center;
                                        position: sticky;
                                        top: 0;
                                        background-color: #000;
                                        z-index: 1;
                                    "
                                >
                                    Author ID
                                </th>
                                <th
                                    style="
                                        border: 1px solid #0f0;
                                        padding: 8px;
                                        text-align: left;
                                        position: sticky;
                                        top: 0;
                                        background-color: #000;
                                        z-index: 1;
                                    "
                                >
                                    Body
                                </th>
                                <th
                                    style="
                                        border: 1px solid #0f0;
                                        padding: 8px;
                                        text-align: center;
                                        position: sticky;
                                        top: 0;
                                        background-color: #000;
                                        z-index: 1;
                                    "
                                >
                                    Internal
                                </th>
                                <th
                                    style="
                                        border: 1px solid #0f0;
                                        padding: 8px;
                                        text-align: left;
                                        position: sticky;
                                        top: 0;
                                        background-color: #000;
                                        z-index: 1;
                                    "
                                >
                                    Created At
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Comments will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div>
                <h3>Assign Ticket to Self (PUT /agent/tickets/{id})</h3>
                <form id="assignAgentTicketForm">
                    <div class="form-group-item">
                        <label for="assignTicketId">Ticket ID:</label>
                        <input
                            type="text"
                            id="assignTicketId"
                            name="id"
                            required
                            class="js-number-input"
                        />
                    </div>
                    <button type="submit">Assign to Self</button>
                </form>
            </div>
        </div>

        <div id="customer" class="model-section">
            <h2>Customer Features</h2>
            <div>
                <h3>Create New Ticket (POST /customer/tickets)</h3>
                <form id="createCustomerTicketForm">
                    <div class="form-group-item">
                        <label for="customerTicketTitle">Title:</label>
                        <input
                            type="text"
                            id="customerTicketTitle"
                            name="title"
                            required
                        />
                    </div>
                    <div class="form-group-item full-width-item">
                        <label for="customerTicketDescription"
                            >Description:</label
                        >
                        <textarea
                            id="customerTicketDescription"
                            name="description"
                        ></textarea>
                    </div>
                    <div class="form-group-item">
                        <label for="customerTicketPriority">Priority:</label>
                        <select
                            id="customerTicketPriority"
                            name="priority"
                        >
                            <option value="Low">Low</option>
                            <option value="Medium">Medium</option>
                            <option value="High">High</option>
                            <option value="Urgent">Urgent</option>
                        </select>
                    </div>
                    <button type="submit">Create Ticket</button>
                </form>
            </div>

            <div>
                <h3>List My Tickets (GET /customer/tickets)</h3>
                <form id="listCustomerTicketsForm">
                    <button type="submit">List My Tickets</button>
                </form>
            </div>

            <div>
                <h3>View My Ticket (GET /customer/tickets/{id})</h3>
                <form id="getCustomerTicketForm">
                    <label for="customerGetTicketId">Ticket ID:</label>
                    <input
                        type="text"
                        id="customerGetTicketId"
                        name="id"
                        required
                        class="js-number-input"
                    />
                    <button type="submit">Get My Ticket</button>
                </form>
            </div>

            <div>
                <h3>
                    Add Comment to My Ticket (POST
                    /customer/tickets/{id}/comments)
                </h3>
                <form id="addCustomerCommentForm">
                    <div class="form-group-item">
                        <label for="customerCommentTicketId">Ticket ID:</label>
                        <input
                            type="text"
                            id="customerCommentTicketId"
                            name="ticket_id"
                            required
                            class="js-number-input"
                        />
                    </div>
                    <div class="form-group-item full-width-item">
                        <label for="customerCommentBody">Comment:</label>
                        <textarea
                            id="customerCommentBody"
                            name="body"
                            required
                        ></textarea>
                    </div>
                    <button type="submit">Add Comment</button>
                </form>
            </div>

            <div id="customerTicketCommentsSection" style="display: none">
                <h3>Comments for this Ticket</h3>
                <input
                    type="text"
                    id="customerCommentSearchInput"
                    placeholder="Search comments..."
                    style="
                        width: 90%;
                        margin-bottom: 10px;
                        margin-left: 3%;
                    "
                />
                <div
                    style="
                        max-height: 600px;
                        overflow-y: auto;
                        border: 1px solid #0f0;
                    "
                >
                    <table
                        id="customerTicketCommentsTable"
                        style="width: 100%; margin-top: 10px"
                    >
                        <thead>
                            <tr>
                                <th
                                    style="
                                        border: 1px solid #0f0;
                                        padding: 8px;
                                        text-align: center;
                                        position: sticky;
                                        top: 0;
                                        background-color: #000;
                                        z-index: 1;
                                    "
                                >
                                    ID
                                </th>
                                <th
                                    style="
                                        border: 1px solid #0f0;
                                        padding: 8px;
                                        text-align: center;
                                        position: sticky;
                                        top: 0;
                                        background-color: #000;
                                        z-index: 1;
                                    "
                                >
                                    Author ID
                                </th>
                                <th
                                    style="
                                        border: 1px solid #0f0;
                                        padding: 8px;
                                        text-align: left;
                                        position: sticky;
                                        top: 0;
                                        background-color: #000;
                                        z-index: 1;
                                    "
                                >
                                    Body
                                </th>
<!--                                <th-->
<!--                                    style="-->
<!--                                        border: 1px solid #0f0;-->
<!--                                        padding: 8px;-->
<!--                                        text-align: center;-->
<!--                                        position: sticky;-->
<!--                                        top: 0;-->
<!--                                        background-color: #000;-->
<!--                                        z-index: 1;-->
<!--                                    "-->
<!--                                >-->
<!--                                    Internal-->
<!--                                </th>-->
                                <th
                                    style="
                                        border: 1px solid #0f0;
                                        padding: 8px;
                                        text-align: left;
                                        position: sticky;
                                        top: 0;
                                        background-color: #000;
                                        z-index: 1;
                                    "
                                >
                                    Created At
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Comments will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div>
                <h3>Close My Ticket (PUT /customer/tickets/{id})</h3>
                <form id="closeCustomerTicketForm">
                    <label for="customerCloseTicketId">Ticket ID:</label>
                    <input
                        type="text"
                        id="customerCloseTicketId"
                        name="id"
                        required
                        class="js-number-input"
                    />
                    <button type="submit">Close Ticket</button>
                </form>
            </div>
        </div>

        <h2>API Response:</h2>
        <div id="response-container">
            <pre id="apiResponse"></pre>
        </div>

        <script>
            const apiResponse = document.getElementById("apiResponse");
            const currentJwtDisplay = document.getElementById("currentJwt");
            let jwtToken = localStorage.getItem("jwtToken") || "";

            function updateJwtDisplay() {
                currentJwtDisplay.textContent =
                    jwtToken || "No JWT token found.";
            }

            function clearJwt() {
                jwtToken = "";
                localStorage.removeItem("jwtToken");
                updateJwtDisplay();
                alert("JWT token cleared.");
            }

            updateJwtDisplay(); // Initialize JWT display on load

            function clearApiResponse() {
                apiResponse.textContent = "";
            }

            function showModel(modelName) {
                clearApiResponse();
                document
                    .querySelectorAll(".model-section")
                    .forEach((section) => {
                        section.classList.remove("active");
                    });
                document.getElementById(modelName).classList.add("active");

                document.querySelectorAll(".menu button").forEach((button) => {
                    button.classList.remove("active");
                });
                document
                    .querySelector(
                        `.menu button[onclick="showModel('${modelName}')"]`,
                    )
                    .classList.add("active");

                // For admin section, show users by default
                if (modelName === "admin") {
                    showAdminSection("users");
                }
            }

            function showAdminSection(sectionName) {
                document.getElementById(
                    "viewTicketDetailsSection",
                ).style.display = "none";
                document.getElementById("ticketDetailsForm").style.display =
                    "none"; // Hide ticket details form initially
                document.getElementById(
                    "addCommentSection",
                ).style.display = "none"; // Hide add comment section initially
                document.getElementById(
                    "ticketCommentsSection",
                ).style.display = "none"; // Hide comments section initially

                document
                    .querySelectorAll(".admin-sub-section")
                    .forEach((section) => {
                        section.classList.remove("active");
                    });
                document
                    .getElementById(`admin-${sectionName}`)
                    .classList.add("active");

                document
                    .querySelectorAll("#admin .menu button")
                    .forEach((button) => {
                        button.classList.remove("active");
                    });
                document
                    .querySelector(
                        `#admin .menu button[onclick="showAdminSection('${sectionName}')"]`,
                    )
                    .classList.add("active");
            }

            async function callApi(method, path, body = null) {
                clearApiResponse();
                const options = { method };
                options.headers = { "Content-Type": "application/json" };

                if (body) {
                    options.body = JSON.stringify(body);
                }

                if (jwtToken && path !== `${baseUrl}/login`) {
                    // Don't send JWT to login endpoint
                    options.headers["Authorization"] = `Bearer ${jwtToken}`;
                }

                try {
                    const response = await fetch(path, options);
                    const textData = await response.text();

                    try {
                        const jsonData = JSON.parse(textData);
                        apiResponse.textContent = JSON.stringify(jsonData, null, 2);
                    } catch (jsonError) {
                        // If not JSON, display as plain text
                        apiResponse.textContent = textData;
                    }
                } catch (error) {
                    apiResponse.textContent = "Error: " + error.message;
                    console.error("API Call Error:", error);
                }
            }

            const baseUrl = window.location.origin;

            // Login Form
            document
                .getElementById("loginForm")
                .addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const email = document.getElementById("loginEmail").value;
                    const password =
                        document.getElementById("loginPassword").value;

                    try {
                        const response = await fetch(`${baseUrl}/login`, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ email, password }),
                        });
                        const data = await response.json();

                        if (response.ok) {
                            jwtToken = data.token;
                            localStorage.setItem("jwtToken", jwtToken);
                            updateJwtDisplay();
                            apiResponse.textContent = JSON.stringify(
                                data,
                                null,
                                2,
                            );
                            alert("Login successful! JWT token stored.");
                        } else {
                            apiResponse.textContent = `Error: ${data.message || JSON.stringify(data)}`;
                            alert("Login failed.");
                        }
                    } catch (error) {
                        apiResponse.textContent = "Error: " + error.message;
                        console.error("Login Error:", error);
                    }
                });

            // Admin User Forms
            document
                .getElementById("listUsersForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    callApi("GET", `${baseUrl}/admin/`);
                });

            document
                .getElementById("listAdminsForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    callApi("GET", `${baseUrl}/admin/role/Admin`);
                });
            document
                .getElementById("listAgentsForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    callApi("GET", `${baseUrl}/admin/role/Agent`);
                });
            document
                .getElementById("listCustomersForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    callApi("GET", `${baseUrl}/admin/role/Customer`);
                });

            document
                .getElementById("createUserForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    const name = document.getElementById("createName").value;
                    const email = document.getElementById("createEmail").value;
                    const role = document.getElementById("createRole").value;
                    callApi("POST", `${baseUrl}/admin/`, {
                        Name: name,
                        Email: email,
                        Role: role,
                        PasswordHash: "password",
                    }); // PasswordHash is a placeholder
                });

            document
                .getElementById("getUserForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    const id = document.getElementById("getUserId").value;
                    callApi("GET", `${baseUrl}/admin/${id}`);
                });

            document
                .getElementById("updateUserForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    const id = document.getElementById("updateUserId").value;
                    const name = document.getElementById("updateName").value;
                    const email = document.getElementById("updateEmail").value;
                    const role = document.getElementById("updateRole").value;
                    callApi("PUT", `${baseUrl}/admin/update/${id}`, {
                        Name: name,
                        Email: email,
                        Role: role,
                    });
                });

            document
                .getElementById("deleteUserForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    const id = document.getElementById("deleteUserId").value;
                    callApi("DELETE", `${baseUrl}/admin/delete/${id}`);
                });

            function showTicketForm(formType) {
                document.getElementById("createTicketSection").style.display =
                    "none";
                document.getElementById("updateTicketSection").style.display =
                    "none";
                document.getElementById("updateTicketForm").style.display =
                    "none"; // Hide update form initially

                document
                    .querySelectorAll(".button-group button")
                    .forEach((button) => {
                        button.classList.remove("active");
                    });

                if (formType === "create") {
                    document.getElementById(
                        "createTicketSection",
                    ).style.display = "block";
                    document
                        .querySelector(".button-group button:nth-child(1)")
                        .classList.add("active");
                } else if (formType === "update") {
                    document.getElementById(
                        "updateTicketSection",
                    ).style.display = "block";
                    document
                        .querySelector(".button-group button:nth-child(2)")
                        .classList.add("active");
                }
            }

            // Initial display for ticket forms
            showTicketForm("create");

            // Admin Ticket Forms
            document
                .getElementById("listTicketsForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    callApi("GET", `${baseUrl}/admin/tickets`);
                });

            document
                .getElementById("createTicketForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    const title =
                        document.getElementById("createTicketTitle").value;
                    const description = document.getElementById(
                        "createTicketDescription",
                    ).value;
                    const status =
                        document.getElementById("createTicketStatus").value;
                    const priority = document.getElementById(
                        "createTicketPriority",
                    ).value;
                    const requesterId = parseInt(
                        document.getElementById("createTicketRequesterId")
                            .value,
                    );
                    const assigneeIdInput = document.getElementById(
                        "createTicketAssigneeId",
                    ).value;
                    const assigneeId = assigneeIdInput
                        ? parseInt(assigneeIdInput)
                        : null;

                    const ticketData = {
                        Title: title,
                        Description: description,
                        Status: status,
                        Priority: priority,
                        RequesterID: requesterId,
                    };

                    if (assigneeId !== null) {
                        ticketData.AssigneeID = assigneeId;
                    }

                    callApi("POST", `${baseUrl}/admin/tickets`, ticketData);
                });

            document
                .getElementById("loadTicketForm")
                .addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const ticketId =
                        document.getElementById("updateTicketId").value;
                    if (!ticketId) return;

                    try {
                        const response = await fetch(
                            `${baseUrl}/admin/tickets/${ticketId}`,
                            {
                                headers: {
                                    Authorization: `Bearer ${jwtToken}`,
                                },
                            },
                        );
                        const data = await response.json();

                        if (response.ok) {
                            document.getElementById(
                                "hiddenUpdateTicketId",
                            ).value = data.ID;
                            document.getElementById("updateTicketTitle").value =
                                data.Title;
                            document.getElementById(
                                "updateTicketDescription",
                            ).value = data.Description;
                            document.getElementById(
                                "updateTicketStatus",
                            ).value = data.Status;
                            document.getElementById(
                                "updateTicketPriority",
                            ).value = data.Priority;
                            document.getElementById(
                                "updateTicketRequesterId",
                            ).value = data.RequesterID;
                            document.getElementById(
                                "updateTicketAssigneeId",
                            ).value = data.AssigneeID.Int64 || "";
                            document.getElementById(
                                "updateTicketForm",
                            ).style.display = "block";
                        } else {
                            apiResponse.textContent = `Error: ${data}`;
                            document.getElementById(
                                "updateTicketForm",
                            ).style.display = "none";
                        }
                    } catch (error) {
                        apiResponse.textContent = "Error: " + error.message;
                        console.error("API Call Error:", error);
                        document.getElementById(
                            "updateTicketForm",
                        ).style.display = "none";
                    }
                });

            document
                .getElementById("updateTicketForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    const ticketId = document.getElementById(
                        "hiddenUpdateTicketId",
                    ).value;
                    const title =
                        document.getElementById("updateTicketTitle").value;
                    const description = document.getElementById(
                        "updateTicketDescription",
                    ).value;
                    const status =
                        document.getElementById("updateTicketStatus").value;
                    const priority = document.getElementById(
                        "updateTicketPriority",
                    ).value;
                    const requesterId = parseInt(
                        document.getElementById("updateTicketRequesterId")
                            .value,
                    );
                    const assigneeIdInput = document.getElementById(
                        "updateTicketAssigneeId",
                    ).value;
                    const assigneeId = assigneeIdInput
                        ? parseInt(assigneeIdInput)
                        : null;

                    const ticketData = {
                        ID: ticketId,
                        Title: title,
                        Description: description,
                        Status: status,
                        Priority: priority,
                        RequesterID: requesterId,
                    };

                    if (assigneeId !== null) {
                        ticketData.AssigneeID = assigneeId;
                    }

                    callApi(
                        "PUT",
                        `${baseUrl}/admin/tickets/${ticketId}`,
                        ticketData,
                    );
                });

            // Admin Comment Forms
            function showCommentSection(sectionType) {
                clearApiResponse();
                document.getElementById(
                    "viewTicketDetailsSection",
                ).style.display = "none";
                document.getElementById("ticketDetailsForm").style.display =
                    "none"; // Hide ticket details form initially
                document.getElementById(
                    "addCommentSection",
                ).style.display = "none"; // Hide add comment section initially
                document.getElementById(
                    "ticketCommentsSection",
                ).style.display = "none"; // Hide comments section initially

                document
                    .querySelectorAll("#admin-comments .button-group button")
                    .forEach((button) => {
                        button.classList.remove("active");
                    });

                if (sectionType === "list") {
                    callApi("GET", `${baseUrl}/admin/comments`);
                    document
                        .querySelector(
                            "#admin-comments .button-group button:nth-child(1)",
                        )
                        .classList.add("active");
                } else if (sectionType === "view_ticket") {
                    document.getElementById(
                        "viewTicketDetailsSection",
                    ).style.display = "block";
                    document
                        .querySelector(
                            "#admin-comments .button-group button:nth-child(2)",
                        )
                        .classList.add("active");
                }
            }

            document
                .getElementById("loadTicketDetailsForm")
                .addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const ticketId =
                        document.getElementById("viewTicketId").value;
                    if (!ticketId) return;

                    // Call callApi to fetch and display the raw JSON response
                    await callApi("GET", `${baseUrl}/admin/tickets/${ticketId}`);

                    // Now, parse the content from apiResponse to populate the form fields
                    try {
                        const data = JSON.parse(apiResponse.textContent);

                        if (data) {
                            document.getElementById("detailTicketId").value =
                                data.ID;
                            document.getElementById("detailTicketTitle").value =
                                data.Title;
                            document.getElementById(
                                "detailTicketDescription",
                            ).value = data.Description;
                            document.getElementById(
                                "detailTicketStatus",
                            ).value = data.Status;
                            document.getElementById(
                                "detailTicketPriority",
                            ).value = data.Priority;
                            document.getElementById(
                                "detailTicketRequesterId",
                            ).value = data.RequesterID;
                            document.getElementById(
                                "detailTicketAssigneeId",
                            ).value = data.AssigneeID.Int64 || "";
                            document.getElementById(
                                "detailTicketCreatedAt",
                            ).value = new Date(data.CreatedAt).toLocaleString();
                            document.getElementById(
                                "detailTicketUpdatedAt",
                            ).value = new Date(data.UpdatedAt).toLocaleString();
                            document.getElementById(
                                "detailTicketClosedAt",
                            ).value = data.ClosedAt.Valid
                                ? new Date(data.ClosedAt.Time).toLocaleString()
                                : "";
                            document.getElementById(
                                "ticketDetailsForm",
                            ).style.display = "grid"; // Display as grid

                            // Show and populate add comment section
                            document.getElementById(
                                "addCommentSection",
                            ).style.display = "block";
                            document.getElementById(
                                "addCommentTicketId",
                            ).value = data.ID;

                            // Load comments for this ticket
                            const commentsData = data.Comments;
                            const commentsTableBody = document.querySelector(
                                "#ticketCommentsTable tbody",
                            );
                            commentsTableBody.innerHTML = ""; // Clear existing comments
                            if (commentsData && commentsData.length > 0) {
                                commentsData.forEach((comment) => {
                                    const row = commentsTableBody.insertRow();
                                    row.insertCell().outerHTML = `<td style="border: 1px solid #0F0; text-align: center;">${comment.ID}</td>`;
                                    row.insertCell().outerHTML = `<td style="border: 1px solid #0F0; text-align: center;">${comment.AuthorID}</td>`;
                                    row.insertCell().outerHTML = `<td style="border: 1px solid #0F0;">${comment.Body}</td>`;
                                    row.insertCell().outerHTML = `<td style="border: 1px solid #0F0; text-align: center;">${comment.IsInternal ? "Yes" : "No"}</td>`;
                                    row.insertCell().outerHTML = `<td style="border: 1px solid #0F0;">${new Date(comment.CreatedAt).toLocaleString()}</td>`;
                                });
                                document.getElementById(
                                    "ticketCommentsSection",
                                ).style.display = "block";
                            } else {
                                commentsTableBody.innerHTML =
                                    '<tr><td colspan="5" style="border: 1px solid #0F0;">No comments found for this ticket.</td></tr>';
                                document.getElementById(
                                    "ticketCommentsSection",
                                ).style.display = "block";
                            }
                        } else {
                            // Handle cases where data is null or empty after parsing
                            apiResponse.textContent = "Error: Could not parse ticket data.";
                            document.getElementById(
                                "ticketDetailsForm",
                            ).style.display = "none";
                            document.getElementById(
                                "addCommentSection",
                            ).style.display = "none"; // Hide add comment section on error
                            document.getElementById(
                                "ticketCommentsSection",
                            ).style.display = "none"; // Hide comments section on error
                        }
                    } catch (error) {
                        apiResponse.textContent = "Error parsing response: " + error.message;
                        console.error("JSON Parse Error:", error);
                        document.getElementById(
                            "ticketDetailsForm",
                        ).style.display = "none";
                        document.getElementById(
                            "addCommentSection",
                        ).style.display = "none"; // Hide add comment section on error
                        document.getElementById(
                            "ticketCommentsSection",
                        ).style.display = "none"; // Hide comments section on error
                    }
                });

            document
                .getElementById("commentSearchInput")
                .addEventListener("keyup", function () {
                    const filter = this.value.toLowerCase();
                    const rows = document.querySelectorAll(
                        "#ticketCommentsTable tbody tr",
                    );
                    rows.forEach((row) => {
                        const text = row.textContent.toLowerCase();
                        row.style.display = text.includes(filter) ? "" : "none";
                    });
                });

            document
                .getElementById("addCommentForm")
                .addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const ticketId = parseInt(
                        document.getElementById("addCommentTicketId").value,
                    );
                    const authorId = parseInt(
                        document.getElementById("addCommentAuthorId").value,
                    );
                    const body =
                        document.getElementById("addCommentBody").value;
                    const isInternal = document.getElementById(
                        "addCommentIsInternal",
                    ).checked;

                    const commentData = {
                        TicketID: ticketId,
                        AuthorID: authorId,
                        Body: body,
                        IsInternal: isInternal,
                    };

                    await callApi(
                        "POST",
                        `${baseUrl}/admin/comments`,
                        commentData,
                    );

                    // Repoll the ticket data to refresh the comments table
                    document
                        .getElementById("loadTicketDetailsForm")
                        .requestSubmit();
                });

            // Agent Forms
            // Removed listAgentTicketsForm event listener as it's replaced by new buttons

            document
                .getElementById("loadAgentTicketForm")
                .addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const ticketId =
                        document.getElementById("agentTicketId").value;
                    if (!ticketId) return;

                    try {
                        const response = await fetch(
                            `${baseUrl}/agent/tickets/${ticketId}`,
                            {
                                headers: {
                                    Authorization: `Bearer ${jwtToken}`,
                                },
                            },
                        );
                        const data = await response.json();

                        if (response.ok) {
                            document.getElementById(
                                "hiddenAgentTicketId",
                            ).value = data.ID;
                            document.getElementById("agentTicketTitle").value =
                                data.Title;
                            document.getElementById(
                                "agentTicketDescription",
                            ).value = data.Description;
                            document.getElementById("agentTicketStatus").value =
                                data.Status;
                            document.getElementById(
                                "agentTicketPriority",
                            ).value = data.Priority;
                            document.getElementById(
                                "updateAgentTicketForm",
                            ).style.display = "block";

                            // Load comments for this ticket (reusing admin logic)
                            const commentsData = data.Comments;
                            const commentsTableBody = document.querySelector(
                                "#agentTicketCommentsTable tbody",
                            );
                            commentsTableBody.innerHTML = ""; // Clear existing comments
                            if (commentsData && commentsData.length > 0) {
                                commentsData.forEach((comment) => {
                                    const row = commentsTableBody.insertRow();
                                    row.insertCell().outerHTML = `<td style="border: 1px solid #0F0; text-align: center;">${comment.ID}</td>`;
                                    row.insertCell().outerHTML = `<td style="border: 1px solid #0F0; text-align: center;">${comment.AuthorID}</td>`;
                                    row.insertCell().outerHTML = `<td style="border: 1px solid #0F0;">${comment.Body}</td>`;
                                    row.insertCell().outerHTML = `<td style="border: 1px solid #0F0; text-align: center;">${comment.IsInternal ? "Yes" : "No"}</td>`;
                                    row.insertCell().outerHTML = `<td style="border: 1px solid #0F0;">${new Date(comment.CreatedAt).toLocaleString()}</td>`;
                                });
                                document.getElementById(
                                    "agentTicketCommentsSection",
                                ).style.display = "block";
                            } else {
                                commentsTableBody.innerHTML =
                                    '<tr><td colspan="5" style="border: 1px solid #0F0;">No comments found for this ticket.</td></tr>';
                                document.getElementById(
                                    "agentTicketCommentsSection",
                                ).style.display = "block";
                            }

                        } else {
                            apiResponse.textContent = `Error: ${data.message || JSON.stringify(data)}`;
                            document.getElementById(
                                "updateAgentTicketForm",
                            ).style.display = "none";
                            document.getElementById(
                                "agentTicketCommentsSection",
                            ).style.display = "none"; // Hide comments section on error
                        }
                    } catch (error) {
                        apiResponse.textContent = "Error: " + error.message;
                        console.error("API Call Error:", error);
                        document.getElementById(
                            "updateAgentTicketForm",
                        ).style.display = "none";
                        document.getElementById(
                            "agentTicketCommentsSection",
                        ).style.display = "none"; // Hide comments section on error
                    }
                });

            document
                .getElementById("updateAgentTicketForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    const ticketId = document.getElementById(
                        "hiddenAgentTicketId",
                    ).value;
                    const status =
                        document.getElementById("agentTicketStatus").value;
                    const priority = document.getElementById(
                        "agentTicketPriority",
                    ).value;

                    const ticketData = {
                        status: status,
                        priority: priority,
                    };

                    callApi(
                        "PUT",
                        `${baseUrl}/agent/tickets/${ticketId}`,
                        ticketData,
                    );
                });

            document
                .getElementById("addAgentCommentForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    const ticketId = parseInt(
                        document.getElementById("agentCommentTicketId").value,
                    );
                    const body =
                        document.getElementById("agentCommentBody").value;
                    const isInternal = document.getElementById(
                        "agentCommentIsInternal",
                    ).checked;

                    const commentData = {
                        ticket_id: ticketId,
                        body: body,
                        is_internal: isInternal,
                    };

                    callApi(
                        "POST",
                        `${baseUrl}/agent/tickets/${ticketId}/comments`,
                        commentData,
                    );
                });

            document
                .getElementById("assignAgentTicketForm")
                .addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const ticketId = document.getElementById("assignTicketId").value;
                    if (!ticketId) return;

                    // Assuming the backend will assign the ticket to the authenticated agent
                    // when assignee_id is not explicitly provided in the payload for this specific action.
                    // If the backend requires the agent's ID, it would need to be extracted from the JWT.
                    // For simplicity and security (avoiding JWT parsing on frontend), we rely on backend logic.
                    const userId = getUserIdFromJwt();
                    console.log('User ID from JWT:', userId);
                    if (userId === null) {
                        alert("Could not get user ID from JWT. Please log in again.");
                        return;
                    }
                    const assigneeIdInt = parseInt(userId);
                    console.log('Parsed Assignee ID:', assigneeIdInt);
                    callApi("PUT", `${baseUrl}/agent/tickets/${ticketId}`, { AssigneeID: assigneeIdInt });
                });

            document
                .getElementById("agentCommentSearchInput")
                .addEventListener("keyup", function () {
                    const filter = this.value.toLowerCase();
                    const rows = document.querySelectorAll(
                        "#agentTicketCommentsTable tbody tr",
                    );
                    rows.forEach((row) => {
                        const text = row.textContent.toLowerCase();
                        row.style.display = text.includes(filter) ? "" : "none";
                    });
                });

            function getUserIdFromJwt() {
                console.log('JWT Token in getUserIdFromJwt:', jwtToken);
                try {
                    const base64Url = jwtToken.split('.')[1];
                    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                    }).join(''));
                    const payload = JSON.parse(jsonPayload);
                    console.log('JWT Payload:', payload);
                    return payload.sub; // 'sub' contains the user ID
                } catch (e) {
                    console.error("Error decoding JWT:", e);
                    return null;
                }
            }

            // Customer Forms
            document
                .getElementById("createCustomerTicketForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    const title = document.getElementById(
                        "customerTicketTitle",
                    ).value;
                    const description = document.getElementById(
                        "customerTicketDescription",
                    ).value;

                    const priority = document.getElementById(
                        "customerTicketPriority",
                    ).value;

                    const ticketData = {
                        title: title,
                        description: description,
                        priority: priority,
                    };

                    callApi("POST", `${baseUrl}/customer/tickets`, ticketData);
                });

            document
                .getElementById("listCustomerTicketsForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    callApi("GET", `${baseUrl}/customer/tickets`);
                });

            document
                .getElementById("getCustomerTicketForm")
                .addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const ticketId = document.getElementById(
                        "customerGetTicketId",
                    ).value;
                    if (!ticketId) return;

                    try {
                        const response = await fetch(
                            `${baseUrl}/customer/tickets/${ticketId}`,
                            {
                                headers: {
                                    Authorization: `Bearer ${jwtToken}`,
                                },
                            },
                        );
                        const data = await response.json();

                        if (response.ok) {
                            apiResponse.textContent = JSON.stringify(
                                data,
                                null,
                                2,
                            );

                            // Load comments for this ticket (reusing admin logic)
                            const commentsData = data.Comments;
                            const commentsTableBody = document.querySelector(
                                "#customerTicketCommentsTable tbody",
                            );
                            commentsTableBody.innerHTML = ""; // Clear existing comments
                            if (commentsData && commentsData.length > 0) {
                                commentsData.forEach((comment) => {
                                    const row = commentsTableBody.insertRow();
                                    row.insertCell().outerHTML = `<td style="border: 1px solid #0F0; text-align: center;">${comment.ID}</td>`;
                                    row.insertCell().outerHTML = `<td style="border: 1px solid #0F0; text-align: center;">${comment.AuthorID}</td>`;
                                    row.insertCell().outerHTML = `<td style="border: 1px solid #0F0;">${comment.Body}</td>`;
                                    // row.insertCell().outerHTML = `<td style="border: 1px solid #0F0; text-align: center;">${comment.IsInternal ? "Yes" : "No"}</td>`;
                                    row.insertCell().outerHTML = `<td style="border: 1px solid #0F0;">${new Date(comment.CreatedAt).toLocaleString()}</td>`;
                                });
                                document.getElementById(
                                    "customerTicketCommentsSection",
                                ).style.display = "block";
                            } else {
                                commentsTableBody.innerHTML =
                                    '<tr><td colspan="5" style="border: 1px solid #0F0;">No comments found for this ticket.</td></tr>';
                                document.getElementById(
                                    "customerTicketCommentsSection",
                                ).style.display = "block";
                            }

                        } else {
                            apiResponse.textContent = `Error: ${data.message || JSON.stringify(data)}`;
                            document.getElementById(
                                "customerTicketCommentsSection",
                            ).style.display = "none"; // Hide comments section on error
                        }
                    } catch (error) {
                        apiResponse.textContent = "Error: " + error.message;
                        console.error("API Call Error:", error);
                        document.getElementById(
                            "customerTicketCommentsSection",
                        ).style.display = "none"; // Hide comments section on error
                    }
                });

            document
                .getElementById("addCustomerCommentForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    const ticketId = parseInt(
                        document.getElementById("customerCommentTicketId")
                            .value,
                    );
                    const body = document.getElementById(
                        "customerCommentBody",
                    ).value;

                    const commentData = {
                        ticket_id: ticketId,
                        body: body,
                    };

                    callApi(
                        "POST",
                        `${baseUrl}/customer/tickets/${ticketId}/comments`,
                        commentData,
                    );
                });

            document
                .getElementById("closeCustomerTicketForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    const ticketId = document.getElementById(
                        "customerCloseTicketId",
                    ).value;
                    callApi("PUT", `${baseUrl}/customer/tickets/${ticketId}`, {
                        status: "Closed",
                    });
                });

            function showLoginSection(sectionName) {
                document
                    .querySelectorAll(".login-sub-section")
                    .forEach((section) => {
                        section.style.display = "none";
                    });
                document.getElementById(`login-${sectionName}`).style.display =
                    "block";

                document
                    .querySelectorAll("#login .menu button")
                    .forEach((button) => {
                        button.classList.remove("active");
                    });
                document
                    .querySelector(
                        `#login .menu button[onclick="showLoginSection('${sectionName}')"]`,
                    )
                    .classList.add("active");
            }

            // Initial display for login forms
            showLoginSection("authenticate");

            // Register Customer Form
            document
                .getElementById("registerCustomerForm")
                .addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const name = document.getElementById(
                        "registerCustomerName",
                    ).value;
                    const email = document.getElementById(
                        "registerCustomerEmail",
                    ).value;
                    const password = document.getElementById(
                        "registerCustomerPassword",
                    ).value;

                    try {
                        const response = await fetch(`${baseUrl}/register`, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({
                                name: name,
                                email: email,
                                password: password,
                            }),
                        });
                        const data = await response.json();

                        if (response.ok) {
                            apiResponse.textContent = JSON.stringify(
                                data,
                                null,
                                2,
                            );
                            alert("Customer registration successful!");
                        } else {
                            apiResponse.textContent = `Error: ${data.message || JSON.stringify(data)}`;
                            alert("Customer registration failed.");
                        }
                    } catch (error) {
                        apiResponse.textContent = "Error: " + error.message;
                        console.error("Registration Error:", error);
                    }
                });

            // Forgot Password Forms
            document
                .getElementById("forgotPasswordForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    const email = document.getElementById(
                        "forgotPasswordEmail",
                    ).value;
                    callApi("POST", `${baseUrl}/forgot-password`, {
                        email: email,
                    });
                });

            document
                .getElementById("resetPasswordForm")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    const token = document.getElementById("resetToken").value;
                    const newPassword =
                        document.getElementById("newPassword").value;
                    callApi("POST", `${baseUrl}/reset-password`, {
                        token: token,
                        new_password: newPassword,
                    });
                });

            // Enforce numeric input for elements with class 'js-number-input' and handle arrow key increments/decrements
            document
                .querySelectorAll(".js-number-input")
                .forEach((inputElement) => {
                    inputElement.addEventListener("input", function (event) {
                        // Remove any non-digit characters
                        this.value = this.value.replace(/[^0-9]/g, "");
                    });

                    inputElement.addEventListener("keydown", function (event) {
                        let currentValue = parseInt(this.value) || 0;
                        if (event.key === "ArrowUp") {
                            event.preventDefault(); // Prevent cursor movement
                            this.value = currentValue + 1;
                        } else if (event.key === "ArrowDown") {
                            event.preventDefault(); // Prevent cursor movement
                            this.value = Math.max(0, currentValue - 1); // Ensure value doesn't go below 0
                        }
                    });
                });

            // Initial display
            showModel("login");
        </script>
    </body>
</html>
